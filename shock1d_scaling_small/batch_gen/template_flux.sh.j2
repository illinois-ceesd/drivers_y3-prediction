#!/bin/bash

#flux: --nodes={{ nodes }}
#flux: --time={{ time }}
#flux: --output={{ outfile }}

export MIRGE_CACHE_ROOT="./mirge-cache_{{ nodes }}node"

source {{ emirge_path }}/config/activate_env.sh
source {{ emirge_path }}/mirgecom/scripts/mirge-testing-env.sh

{% for r in ranks %}
$MIRGE_MPI_EXEC -N {{ nodes }} -n {{ r }} $MIRGE_PARALLEL_SPAWNER python -u -O -m mpi4py ./driver -i run_params_np{{ r }}.yaml --lazy
{% endfor %}
